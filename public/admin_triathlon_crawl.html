<!DOCTYPE html>
<html lang="ko">
<head>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Triathlon Data Crawler</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .card { background: white; border-radius: 1.5rem; padding: 2.5rem; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); border: 1px solid #f1f5f9; }
        .input-field { width: 100%; padding: 1rem; border-radius: 1rem; border: 2px solid #e2e8f0; margin-bottom: 1rem; transition: all 0.2s; }
        .input-field:focus { border-color: #3b82f6; outline: none; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .btn-primary { width: 100%; padding: 1rem; border-radius: 1rem; background-color: #3b82f6; color: white; font-weight: bold; transition: all 0.2s; }
        .btn-primary:hover { background-color: #2563eb; transform: translateY(-2px); }
        .btn-primary:active { transform: translateY(0); }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">

    <div class="card max-w-lg w-full text-center">
        <div class="mb-8">
            <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-blue-50 mb-6 text-blue-500">
                <i class="fas fa-spider text-3xl"></i>
            </div>
            <h1 class="text-3xl font-black text-slate-800 mb-2">ì² ì¸3ì¢… ë°ì´í„° ìˆ˜ì§‘ê¸°</h1>
            <p class="text-slate-500 font-medium">ëŒ€í•œì² ì¸3ì¢…í˜‘íšŒ ê¸°ë¡ì‹¤ì—ì„œ<br>ëŒ€íšŒ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ JSONìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.</p>
        </div>

        <div class="space-y-4 text-left">
            <div>
                <label class="block text-sm font-bold text-slate-700 mb-1 ml-1">ëŒ€íšŒëª…</label>
                <input type="text" id="raceName" class="input-field" placeholder="ì˜ˆ: ê³ ë ¹ëŒ€íšŒ">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1 ml-1">ëŒ€íšŒì½”ë“œ (tourcd)</label>
                    <input type="text" id="tourcd" class="input-field" placeholder="ì˜ˆ: 1916">
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1 ml-1">ì—°ë„ (sYear)</label>
                    <input type="text" id="sYear" class="input-field" placeholder="ì˜ˆ: 2024">
                </div>
            </div>
        </div>

        <button onclick="startCrawl()" class="btn-primary mt-6">
            <i class="fas fa-download mr-2"></i> í¬ë¡¤ë§ ì‹œì‘ ë° ë‹¤ìš´ë¡œë“œ
        </button>

        <div id="statusArea" class="mt-8 hidden">
            <div class="flex items-center justify-center gap-2 text-blue-600 font-bold animate-pulse">
                <i class="fas fa-spinner fa-spin"></i> ë°ì´í„° ìˆ˜ì§‘ ì¤‘... (ìµœëŒ€ 1ë¶„ ì†Œìš”)
            </div>
        </div>

        <div class="mt-10 text-left bg-slate-100 p-5 rounded-xl text-xs text-slate-500 leading-relaxed">
            <strong>ğŸ’¡ ì°¸ê³ ì‚¬í•­:</strong><br>
            1. ëŒ€íšŒì½”ë“œëŠ” í˜‘íšŒ í™ˆí˜ì´ì§€ URLì—ì„œ <code>tourcd</code> íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.<br>
            2. ìˆ˜ì§‘ëœ ë°ì´í„°ëŠ” ìë™ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.<br>
            3. ì„œë²„ ë¶€í•˜ ë°©ì§€ë¥¼ ìœ„í•´ ì—°ì† ìš”ì²­ì€ ìì œí•´ì£¼ì„¸ìš”.
        </div>
    </div>

    <script>
        async function startCrawl() {
            const raceName = document.getElementById('raceName').value;
            const tourcd = document.getElementById('tourcd').value;
            const sYear = document.getElementById('sYear').value;

            if (!raceName || !tourcd || !sYear) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const statusArea = document.getElementById('statusArea');
            const btn = document.querySelector('button');
            
            statusArea.classList.remove('hidden');
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');

            const url = `/api/admin/crawl?raceName=${encodeURIComponent(raceName)}&tourcd=${tourcd}&sYear=${sYear}`;
            
            try {
                const res = await fetch(url);
                const data = await res.json();
                
                // ë°ì´í„°ë¥¼ ë¸Œë¼ìš°ì €ì—ì„œ JSON íŒŒì¼ë¡œ ë³€í™˜í•˜ì—¬ ë‹¤ìš´ë¡œë“œ
                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const downloadUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = `${raceName}_${tourcd}_${sYear}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                alert(`ìˆ˜ì§‘ ì™„ë£Œ! ì´ ${data.length}ëª…ì˜ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            } catch (e) {
                alert('ì—ëŸ¬ ë°œìƒ: ' + e.message);
            } finally {
                statusArea.classList.add('hidden');
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }
    </script>
</body>
</html>
