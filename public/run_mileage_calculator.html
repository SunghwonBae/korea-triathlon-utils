<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŸ¬ë‹ - ì›”ê°„ ë§ˆì¼ë¦¬ì§€ ë°°ë¶„ì— ë”°ë¥¸ ì£¼ê°„ ìŠ¤ì¼€ì¤„ëŸ¬</title>
    <link rel="icon" href="/favicon.ico" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="stylesheet" href="bucheonTriStyle.css">
    <script src="menu_full_handler.js" defer></script>
    <style>

        /* ê°€ì´ë“œ ì˜ì—­ */
        .guide-box { background: #f8f9fa; border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid #e9ecef; }
        .guide-title { font-size: 0.9rem; font-weight: bold; margin-bottom: 10px; color: #495057; }
        .guide-list { margin: 0; padding: 0; list-style: none; font-size: 0.85rem; }
        .guide-item { margin-bottom: 5px; display: flex; align-items: center; }
        .dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .training-guide { background: #fff; border: 1px dashed #007AFF; border-radius: 12px; padding: 12px; margin-bottom: 20px; font-size: 0.85rem; }

        /* ìš”ì¼ ì„ íƒê¸° */
        .selector-guide { background: #fff; padding: 12px; border-radius: 12px; margin-bottom: 15px; font-size: 0.85rem; border: 1px solid #eee; }
        .status-dot { width: 12px; height: 12px; border-radius: 3px; margin-right: 8px; border: 1px solid #ddd; display: inline-block; vertical-align: middle; }
        .day-grid { display: flex; justify-content: space-between; gap: 8px; margin-bottom: 25px; }
        .day-box { flex: 1; text-align: center; padding: 15px 0; background: #fff; border: 2px solid #eee; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.2s; user-select: none; }
        .status-none { background: #fff; color: #444; border-color: #eee; }
        .status-rest { background: #4b4b4b; color: #fff; border-color: #4b4b4b; }
        .status-lsd { background: #007AFF; color: #fff; border-color: #007AFF; }

        /* ì…ë ¥ ì˜ì—­ */
        .input-row { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
        .input-group { flex: 1; min-width: 140px; }
        label { display: block; font-size: 0.85rem; font-weight: bold; margin-bottom: 8px; color: #555; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 1rem; }

        button#generate-btn { width: 100%; padding: 16px; background: #222; color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
        
        /* ê²°ê³¼ ì˜ì—­ */
        .result-header { margin-top: 25px; padding: 15px; border-radius: 10px; font-size: 1rem;  text-align: center; display: none; font-weight: bold; }
        .danger { background: #ffebee; color: #c62828; }
        .warning { background: #fff3e0; color: #ef6c00; }
        .safe { background: #e8f5e9; color: #2e7d32; }

        .week-card { margin-top: 20px; border: 1px solid #eee; border-radius: 15px; overflow: hidden; display: none; background: #fff; }
        .week-title { background: #f8f9fa; padding: 12px 20px; font-size: 1rem;  font-weight: bold; border-bottom: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: center; border-bottom: 1px solid #f1f1f1; font-size: 0.9rem; }
        th { background: #fafafa; color: #888; font-size: 0.85rem; }
        .sat { color: #007AFF; } .sun { color: #d32f2f; }
        .pace-val { font-size: 0.8rem; color: #666; display: block; margin-top: 2px; }

        /* ëª¨ë°”ì¼ ê°€ë¡œëª¨ë“œ (Landscape) ìµœì í™” */
        @media (max-height: 600px) and (orientation: landscape) {
            body { padding-top: 40px !important; }
            .header-section { position: fixed !important; top: 0; left: 0; right: 0; height: 40px; padding: 0 15px; z-index: 999; display: flex; align-items: center; }
            .header-section h1 { font-size: 1rem; margin: 0 0 0 10px; line-height: 1; }
            .menu-btn { font-size: 1.2rem; padding: 0; }
            .container { padding-top: 10px !important; margin-top: 0 !important; }

            .guide-box { padding: 8px; margin-bottom: 8px; }
            .guide-title { margin-bottom: 2px; font-size: 0.8rem; }
            .guide-list { display: flex; flex-wrap: wrap; gap: 10px; }
            .guide-item { margin-bottom: 0; font-size: 0.75rem; }
            .training-guide { padding: 8px; margin-bottom: 8px; font-size: 0.75rem; }
            .selector-guide { padding: 5px; margin-bottom: 10px; font-size: 0.75rem; }
            
            .day-grid { margin-bottom: 10px; gap: 4px; }
            .day-box { padding: 8px 0; font-size: 0.9rem; }
            
            .input-row { margin-bottom: 10px; gap: 5px; }
            .input-group label { font-size: 0.75rem; margin-bottom: 2px; }
            input { padding: 6px; font-size: 0.9rem; }
            
            button#generate-btn { padding: 10px; font-size: 1rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-section">
        <button id="menuToggle" class="menu-btn" aria-label="ë©”ë‰´ ì—´ê¸°">â˜°</button>
        <h1>ğŸƒëŸ¬ë‹-ì›”ë§ˆì¼ë¦¬ì§€ ì£¼ê°„ë°°ë¶„</h1>
    </div>
    
    <div class="guide-box">
        <div class="guide-title">ğŸ’¡ ì¦ëŸ‰ í­ ê°€ì´ë“œ (ì „ì›” ëŒ€ë¹„)</div>
        <ul class="guide-list">
            <li class="guide-item"><span class="dot" style="background:#2e7d32"></span> <strong>15% ì´ë‚´:</strong> ë¶€ìƒ ìœ„í—˜ì´ ì ì€ ì•ˆì „í•œ ì¦ëŸ‰</li>
            <li class="guide-item"><span class="dot" style="background:#ef6c00"></span> <strong>15~30%:</strong> ê³µê²©ì ì¸ ì¦ëŸ‰ (íœ´ì‹ í•„ìˆ˜)</li>
            <li class="guide-item"><span class="dot" style="background:#c62828"></span> <strong>30% ì´ˆê³¼:</strong> ê³ ìœ„í—˜ ì¦ëŸ‰ (ì‹ ì²´ ì‹ í˜¸ ì£¼ì˜)</li>
        </ul>
    </div>

    <div class="training-guide">
        <strong>ğŸƒâ€â™‚ï¸ ì­ ë‹¤ë‹ˆì—˜ìŠ¤ í›ˆë ¨ ì›ì¹™:</strong><br>
        Easy(ì¡°ê¹…/LSD): ì‹¬íê¸°ì´ˆ | Threshold(í¬ì¸íŠ¸): ìœ ì‚°ì†Œ ì—­ì¹˜ í–¥ìƒ
    </div>

    <div class="selector-guide">
        <span class="status-dot" style="background:#4b4b4b"></span> íœ´ì‹ &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
        <span class="status-dot" style="background:#007AFF"></span> LSD &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
        <span class="status-dot" style="background:#fff"></span> ì¼ë°˜&nbsp;&nbsp;&nbsp; 
        <br>
        (í•œë²ˆí´ë¦­:íœ´ì‹, ë‘ë²ˆí´ë¦­:LSD, ì„¸ë²ˆí´ë¦­:ì¼ë°˜)
    </div>

    <div class="day-grid" id="dayGrid">
        <div class="day-box status-none" onclick="toggleDay(this)">ì›”</div>
        <div class="day-box status-none" onclick="toggleDay(this)">í™”</div>
        <div class="day-box status-none" onclick="toggleDay(this)">ìˆ˜</div>
        <div class="day-box status-none" onclick="toggleDay(this)">ëª©</div>
        <div class="day-box status-none" onclick="toggleDay(this)">ê¸ˆ</div>
        <div class="day-box status-none" onclick="toggleDay(this)">í† </div>
        <div class="day-box status-lsd" onclick="toggleDay(this)">ì¼</div>
    </div>

    <div class="input-row">
        <div class="input-group"><label>ì´ì „ë‹¬ ê±°ë¦¬(km)</label><input type="number" id="prevDist" value="220"></div>
        <div class="input-group"><label>ëª©í‘œ ê±°ë¦¬(km)</label><input type="number" id="targetDist" value="300"></div>
        <div class="input-group"><label>í’€ì½”ìŠ¤ ëª©í‘œ(ì‹œ:ë¶„)</label><input type="text" id="goalTime" value="3:30"></div>
    </div>

    <button id="generate-btn" onclick="generatePlan()">ìŠ¤ì¼€ì¤„ ë° í˜ì´ìŠ¤ ìƒì„±</button>

    <div id="statusHeader" class="result-header"></div>
    <div id="planContainer"></div>
</div>

<script>
    // ìš”ì¼ ì„ íƒ í† ê¸€ ê¸°ëŠ¥
    function toggleDay(el) {
        if (el.classList.contains('status-none')) {
            el.classList.replace('status-none', 'status-rest');
        } else if (el.classList.contains('status-rest')) {
            document.querySelectorAll('.day-box').forEach(box => {
                if(box.classList.contains('status-lsd')) box.className = 'day-box status-none';
            });
            el.classList.add('status-lsd');
            el.classList.remove('status-rest');
        } else {
            el.classList.replace('status-lsd', 'status-none');
        }
    }

    // ì—…ë¡œë“œëœ vdot.json ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì„±ëœ ì°¸ì¡° í…Œì´ë¸”
    const vdotData = [
        {"vdot": 85, "S": "2:01:10", "E": 200, "T": 166},
        {"vdot": 84, "S": "2:02:24", "E": 203, "T": 168},
        {"vdot": 83, "S": "2:03:40", "E": 205, "T": 169},
        {"vdot": 82, "S": "2:04:57", "E": 206, "T": 171},
        {"vdot": 81, "S": "2:06:17", "E": 208, "T": 173},
        {"vdot": 80, "S": "2:07:38", "E": 211, "T": 174},
        {"vdot": 79, "S": "2:09:02", "E": 213, "T": 176},
        {"vdot": 78, "S": "2:10:27", "E": 215, "T": 178},
        {"vdot": 77, "S": "2:11:54", "E": 217, "T": 180},
        {"vdot": 76, "S": "2:13:23", "E": 220, "T": 182},
        {"vdot": 75, "S": "2:14:55", "E": 222, "T": 184},
        {"vdot": 74, "S": "2:16:29", "E": 225, "T": 186},
        {"vdot": 73, "S": "2:18:05", "E": 227, "T": 188},
        {"vdot": 72, "S": "2:19:44", "E": 230, "T": 190},
        {"vdot": 71, "S": "2:21:26", "E": 232, "T": 192},
        {"vdot": 70, "S": "2:23:10", "E": 235, "T": 194},
        {"vdot": 69, "S": "2:24:57", "E": 238, "T": 196},
        {"vdot": 68, "S": "2:26:47", "E": 241, "T": 199},
        {"vdot": 67, "S": "2:28:40", "E": 243, "T": 201},
        {"vdot": 66, "S": "2:30:36", "E": 248, "T": 204},
        {"vdot": 65, "S": "2:32:35", "E": 250, "T": 206},
        {"vdot": 64, "S": "2:34:38", "E": 253, "T": 209},
        {"vdot": 63, "S": "2:36:44", "E": 256, "T": 212},
        {"vdot": 62, "S": "2:38:54", "E": 260, "T": 214},
        {"vdot": 61, "S": "2:41:08", "E": 263, "T": 217},
        {"vdot": 60, "S": "2:43:25", "E": 266, "T": 220},
        {"vdot": 59, "S": "2:45:47", "E": 270, "T": 223},
        {"vdot": 58, "S": "2:48:14", "E": 274, "T": 225},
        {"vdot": 57, "S": "2:50:45", "E": 278, "T": 230},
        {"vdot": 56, "S": "2:53:20", "E": 281, "T": 233},
        {"vdot": 55, "S": "2:56:01", "E": 286, "T": 236},
        {"vdot": 54, "S": "2:58:47", "E": 290, "T": 240},
        {"vdot": 53, "S": "3:01:39", "E": 295, "T": 244},
        {"vdot": 52, "S": "3:04:36", "E": 299, "T": 247},
        {"vdot": 51, "S": "3:07:39", "E": 304, "T": 251},
        {"vdot": 50, "S": "3:10:49", "E": 308, "T": 255},
        {"vdot": 49, "S": "3:14:06", "E": 313, "T": 260},
        {"vdot": 48, "S": "3:17:29", "E": 319, "T": 264},
        {"vdot": 47, "S": "3:21:00", "E": 324, "T": 269},
        {"vdot": 46, "S": "3:24:39", "E": 330, "T": 273},
        {"vdot": 45, "S": "3:28:26", "E": 336, "T": 278},
        {"vdot": 44, "S": "3:32:23", "E": 341, "T": 283},
        {"vdot": 43, "S": "3:36:28", "E": 348, "T": 289},
        {"vdot": 42, "S": "3:40:43", "E": 355, "T": 294},
        {"vdot": 41, "S": "3:45:09", "E": 361, "T": 300},
        {"vdot": 40, "S": "3:49:45", "E": 368, "T": 306},
        {"vdot": 39, "S": "3:54:34", "E": 376, "T": 313},
        {"vdot": 38, "S": "3:59:35", "E": 383, "T": 319},
        {"vdot": 37, "S": "4:04:50", "E": 391, "T": 326},
        {"vdot": 36, "S": "4:10:19", "E": 400, "T": 333},
        {"vdot": 35, "S": "4:16:03", "E": 409, "T": 341},
        {"vdot": 34, "S": "4:22:03", "E": 418, "T": 348},
        {"vdot": 33, "S": "4:28:22", "E": 428, "T": 356},
        {"vdot": 32, "S": "4:34:59", "E": 438, "T": 365},
        {"vdot": 31, "S": "4:41:57", "E": 449, "T": 375},
        {"vdot": 30, "S": "4:49:17", "E": 460, "T": 384}
    ];

    function getPaces(timeStr) {
        if (!timeStr || !timeStr.includes(':')) return null;
        const [h, m] = timeStr.split(':').map(Number);
        const totalMin = h * 60 + m;

        // ë§ˆë¼í†¤ ì‹œê°„(ë¶„)ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµìš© ë°ì´í„° ìƒì„±
        const table = vdotData.map(d => {
            const [sh, sm, ss] = d.S.split(':').map(Number);
            return { min: sh * 60 + sm + (ss / 60), E: d.E, T: d.T };
        });

        let tPaceSec, ePaceSec;

        // êµ¬ê°„ ë³´ê°„ë²• ì ìš©
        if (totalMin <= table[0].min) {
            tPaceSec = table[0].T;
            ePaceSec = table[0].E;
        } else if (totalMin >= table[table.length - 1].min) {
            tPaceSec = table[table.length - 1].T;
            ePaceSec = table[table.length - 1].E;
        } else {
            for (let i = 0; i < table.length - 1; i++) {
                const start = table[i];
                const end = table[i + 1];
                if (totalMin >= start.min && totalMin <= end.min) {
                    const ratio = (totalMin - start.min) / (end.min - start.min);
                    tPaceSec = start.T + ratio * (end.T - start.T);
                    ePaceSec = start.E + ratio * (end.E - start.E);
                    break;
                }
            }
        }

        const formatPace = (sec) => {
            const min = Math.floor(sec / 60);
            const s = Math.round(sec % 60);
            return `${min}:${s < 10 ? '0' + s : s}`;
        };

        return { easy: formatPace(ePaceSec), threshold: formatPace(tPaceSec) };
    }

    // ë‚˜ë¨¸ì§€ generatePlan ë¡œì§ì€ ì´ì „ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€
    function generatePlan() {
        const prev = parseFloat(document.getElementById('prevDist').value);
        const target = parseFloat(document.getElementById('targetDist').value);
        const paces = getPaces(document.getElementById('goalTime').value);
        
        const dayBoxes = document.querySelectorAll('.day-box');
        let restDays = [], lsdDay = -1;
        dayBoxes.forEach((box, idx) => {
            if (box.classList.contains('status-rest')) restDays.push(idx);
            if (box.classList.contains('status-lsd')) lsdDay = idx;
        });

        if (lsdDay === -1) { alert("LSD ìš”ì¼ì„ ì§€ì •í•´ì£¼ì„¸ìš”."); return; }

        const rate = ((target - prev) / prev * 100).toFixed(1);
        const statusHeader = document.getElementById('statusHeader');
        statusHeader.style.display = 'block';
        statusHeader.className = 'result-header ' + (rate > 30 ? 'danger' : rate > 15 ? 'warning' : 'safe');
        statusHeader.innerHTML = `ì¦ëŸ‰ í­: ${rate}% (${target}km ëª©í‘œ) ${paces ? ` | VDOT ë°ì´í„° ì ìš©ë¨` : ''}`;

        const weekWeights = [0.22, 0.26, 0.30, 0.22]; 
        const weekLabels = ["(ì ì‘ê¸°)", "(ê°•ë„ í–¥ìƒ)", "(í”¼í¬ ì£¼ê°„)", "(ì¡°ì • ë° íšŒë³µ)"];
        const dayNames = ["ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† ", "ì¼"];
        const planContainer = document.getElementById('planContainer');
        planContainer.innerHTML = '';

        weekWeights.forEach((wWeight, i) => {
            const weekTotal = target * wWeight;
            let baseWeights = [1.2, 1.2, 0.8, 1.2, 1.2, 1.2, 1.2]; 
            baseWeights[lsdDay] = 2.5;

            let activeSum = 0;
            baseWeights.forEach((bw, idx) => { if (!restDays.includes(idx)) activeSum += bw; });

            let html = `<div class="week-card" style="display:block">
                <div class="week-title">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span>${i+1}ì£¼ì°¨ ${weekLabels[i]}</span>
                        <span style="color:#007AFF">${weekTotal.toFixed(1)}km</span>
                    </div>
                </div>
                <table><thead><tr><th>ìš”ì¼</th><th>êµ¬ë¶„</th><th>ê±°ë¦¬ ë° í˜ì´ìŠ¤</th></tr></thead><tbody>`;

            dayNames.forEach((day, j) => {
                const isRest = restDays.includes(j);
                const isLsd = (j === lsdDay);
                const isPoint = (!isRest && !isLsd && j === 2); 

                let type = isRest ? "íœ´ì‹" : isLsd ? "LSD" : isPoint ? "í¬ì¸íŠ¸" : "ì¡°ê¹…";
                let dist = isRest ? "-" : (weekTotal * (baseWeights[j] / activeSum)).toFixed(1) + "km";
                let paceInfo = (paces && !isRest) ? `<span class="pace-val" style="font-size:0.8rem; color:#666; display:block;">Pace: ${isPoint ? paces.threshold : paces.easy}</span>` : "";

                let dayCls = (j === 5) ? "sat" : (j === 6) ? "sun" : "";
                let typeStyle = isLsd ? "color:#007AFF; font-weight:bold;" : isPoint ? "color:#e67e22; font-weight:bold;" : "";

                html += `<tr><td class="${dayCls}">${day}</td><td style="${typeStyle}">${type}</td><td class="dist-val">${dist}${paceInfo}</td></tr>`;
            });
            html += `</tbody></table></div>`;
            planContainer.innerHTML += html;
        });
    }

    // PWA ë’¤ë¡œê°€ê¸° 2ë²ˆ ì¢…ë£Œ ë¡œì§
    (function() {
        let lastBackPressTime = 0;
        history.pushState(null, null, location.href);
        window.addEventListener('popstate', function() {
            const now = new Date().getTime();
            if (now - lastBackPressTime < 2000) { history.back(); return; }
            lastBackPressTime = now;
            history.pushState(null, null, location.href);
            const t = document.createElement('div');
            t.innerText = "'ë’¤ë¡œ' ë²„íŠ¼ì„ í•œë²ˆ ë” ëˆ„ë¥´ë©´ ì¢…ë£Œë©ë‹ˆë‹¤.";
            Object.assign(t.style, {
                position:'fixed', bottom:'20px', left:'50%', transform:'translateX(-50%)',
                background:'rgba(0,0,0,0.7)', color:'#fff', padding:'10px 20px',
                borderRadius:'20px', zIndex:9999, fontSize:'0.9rem', pointerEvents:'none'
            });
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 2000);
        });
    })();
</script>
</body>
</html>