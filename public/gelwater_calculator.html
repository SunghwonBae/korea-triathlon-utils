<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—ë„ˆì§€ & ìˆ˜ë¶„ ë³´ê¸‰ ì‹œë®¬ë ˆì´í„°</title>
    <link rel="icon" href="/favicon.ico" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="stylesheet" href="bucheonTriStyle.css">
    <script src="menu_full_handler.js" defer></script>

    <style>
        :root { --primary-color: #f39c12; --water-color: #3498db; --gel-color: #e74c3c; }
        .hl-cell { background-color: #fff9c4 !important; font-weight: bold; outline: 2px solid #f39c12; color: #d35400; }
        .hl-header { background-color: #ffe082 !important; }
        .summary-box { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .summary-card { background: #fff; padding: 15px; border-radius: 12px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 5px solid var(--primary-color); }
        .summary-card.water { border-top-color: var(--water-color); }
        .summary-card.gel { border-top-color: var(--gel-color); }
        .summary-card h3 { font-size: 0.85em; color: #7f8c8d; margin-bottom: 5px; }
        .summary-card b { font-size: 1.5em; color: #2c3e50; }
        .warning-text { display: block; font-size: 11px; color: #e74c3c; margin-top: 5px; font-weight: bold; }

        .controls { background: #fff; padding: 20px; border-radius: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .control-group label { font-weight: 700; display: flex; justify-content: space-between; margin-bottom: 8px; }
        .value-display { color: var(--primary-color); font-weight: 800; }
        
        .guide-container { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .info-box { background: #f8f9fa; border-left: 4px solid #adb5bd; padding: 10px; font-size: 0.85em; line-height: 1.6; }
        .standard-guide { background: #fff3e0; border-radius: 8px; padding: 12px; border: 1px solid #ffe0b2; }
        .sweat-guide { background: #e3f2fd; border-radius: 8px; padding: 12px; border: 1px solid #bbdefb; }
        
        input[type=range] { width: 100%; accent-color: var(--primary-color); cursor: pointer; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; text-align: center; background: #fff; }
        th, td { border: 1px solid #dee2e6; padding: 8px 2px; }

        /* ëª¨ë°”ì¼ ê°€ë¡œëª¨ë“œ (Landscape) ìµœì í™” */
        @media (max-height: 600px) and (orientation: landscape) {
            body { padding-top: 40px !important; }
            .header-section { position: fixed !important; top: 0; left: 0; right: 0; height: 40px; padding: 0 15px; z-index: 999; display: flex; align-items: center; }
            .header-section h1 { font-size: 1rem; margin: 0 0 0 10px; line-height: 1; }
            .menu-btn { font-size: 1.2rem; padding: 0; }
            .container { padding-top: 10px !important; margin-top: 0 !important; }

            .info-box { display: block; padding: 5px; font-size: 0.75em; margin-bottom: 5px; }
            .guide-container { display: flex; flex-direction: row; gap: 5px; margin-bottom: 5px; }
            .standard-guide, .sweat-guide { padding: 5px; font-size: 0.75em; flex: 1; }
            
            .summary-box { grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 10px; }
            .summary-card { padding: 8px; }
            .summary-card h3 { font-size: 0.75em; margin-bottom: 2px; }
            .summary-card b { font-size: 1.1em; }
            
            .controls { padding: 10px; gap: 10px; grid-template-columns: 1fr 1fr; margin-bottom: 10px; }
            .control-group label { margin-bottom: 2px; font-size: 0.8em; }
            input[type=range] { margin: 0; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-section">
        <button id="menuToggle" class="menu-btn" aria-label="ë©”ë‰´ ì—´ê¸°">â˜°</button>
        <h1>ğŸŒ ë³´ê¸‰ ì‹œë®¬ë ˆì´í„° </h1>
    </div>

    <div class="info-box">
        <strong>ğŸ’¡ ë³´ê¸‰ ì „ëµ ê°€ì´ë“œ:</strong><br>
        - <b>ì†Œë¹„ìì› ë¦¬í¬íŠ¸:</b> íŒŒì›Œì ¤ 1í¬ë‹¹ íƒ„ìˆ˜í™”ë¬¼ í•¨ëŸ‰(2~29g)ì´ ë‹¤ë¥´ë‹ˆ ê¼­ í™•ì¸í•˜ì„¸ìš”.<br>
        - <b>í˜„ì‹¤ì  ë°°ë¶„:</b> ì „ì²´ ì—ë„ˆì§€ì˜ 60%ë¥¼ ì ¤ë¡œ, ë‚˜ë¨¸ì§€ëŠ” ìŠ¤í¬ì¸  ìŒë£Œ/ê³ í˜•ì‹ìœ¼ë¡œ ì„­ì·¨í•˜ëŠ” ê²ƒì´ ìœ„ì¥ì— ì•ˆì „í•©ë‹ˆë‹¤.<br>ì‹œì¤‘ ìŠ¤í¬ì¸  ìŒë£Œ 500mlì—ëŠ” ì•½ 30gì˜ íƒ„ìˆ˜í™”ë¬¼ì´ ë“¤ì–´ìˆìŠµë‹ˆë‹¤. ë¬¼ ëŒ€ì‹  ìŒë£Œë§Œ ì˜ ë§ˆì…”ë„ íŒŒì›Œì ¤ 10ê°œ ë¶„ëŸ‰ì„ ëŒ€ì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </div>

    <div class="guide-container">
        <div class="standard-guide">
            <strong>ğŸ† 70kg / 12ì‹œê°„ ì™„ì£¼ ê¸°ì¤€:</strong> ì‹œê°„ë‹¹ 60g ì„­ì·¨ ì‹œ ì´ 720g (í˜„ì‹¤ì  ì ¤ ì„­ì·¨ ì•½ 17~20ê°œ + ìŒë£Œ)
        </div>
        <div class="sweat-guide">
            <strong>ğŸ’§ ë•€ ì†ì‹¤ëŸ‰ ê°€ì´ë“œ:</strong> ì„œëŠ˜í•¨(0.5L) / ë³´í†µ(0.8~1.2L) / ë¥ê³ ìŠµí•¨(1.5~2.0L)
        </div>
    </div>

    <div class="summary-box">
        <div class="summary-card">
            <h3>ì´ íƒ„ìˆ˜í™”ë¬¼ í•„ìš”ëŸ‰</h3>
            <span class="value-display"><b id="res-total-carb">0</b> g</span>
        </div>
        <div class="summary-card gel">
            <h3>ì¶”ì²œ íŒŒì›Œì ¤ ê°œìˆ˜ (60%)</h3>
            <span class="value-display" style="color:var(--gel-color)"><b id="res-gel-count">0</b> ê°œ</span>
            <span id="gel-warning" class="warning-text" style="display:none;">âš ï¸ ìœ„ì¥ ì¥ì•  ì£¼ì˜!</span>
        </div>
        <div class="summary-card water">
            <h3>ì´ ìˆ˜ë¶„ í•„ìš”ëŸ‰</h3>
            <span class="value-display" style="color:var(--water-color)"><b id="res-total-water">0</b> L</span>
        </div>
    </div>

    <div class="controls">
        <div class="control-group">
            <label>ì˜ˆìƒ ì™„ì£¼ ì‹œê°„ <div><span id="disp-time" class="value-display">10:00</span></div></label>
            <input type="range" id="in-time" min="120" max="1020" step="15" value="600">
        </div>
        <div class="control-group">
            <label>ì‹œê°„ë‹¹ íƒ„ìˆ˜í™”ë¬¼ <div><span id="disp-carb" class="value-display">60</span> g/h</div></label>
            <input type="range" id="in-carb" min="40" max="110" step="10" value="60">
        </div>
        <div class="control-group">
            <label>ì ¤ 1ê°œë‹¹ íƒ„ìˆ˜í™”ë¬¼ <div><span id="disp-per-gel" class="value-display" style="color:var(--gel-color)">25</span> g</div></label>
            <input type="range" id="in-per-gel" min="10" max="35" step="1" value="25">
        </div>
        <div class="control-group">
            <label>ì‹œê°„ë‹¹ ë•€ ì†ì‹¤ëŸ‰ <div><span id="disp-sweat" class="value-display" style="color:var(--water-color)">0.8</span> L/h</div></label>
            <input type="range" id="in-sweat" min="0.4" max="2.0" step="0.2" value="0.8">
        </div>
    </div>

    <div class="table-wrapper">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h3 style="font-size: 1rem; margin: 0;">ğŸ“‹ ì™„ì£¼ì‹œê°„ ëŒ€ë¹„ ì¶”ì²œ ì ¤ ì†Œìš”ëŸ‰ (ì—ë„ˆì§€ 60% ë¹„ì¤‘)</h3>
            <button onclick="downloadCSV('tbl-gel', 'gel_simulation.csv')" title="CSV ë‹¤ìš´ë¡œë“œ" style="background: none; border: none; cursor: pointer; padding: 0;">
                <img src="xlsdown.png" alt="Download CSV" style="width: 24px; height: 24px; display: block;">
            </button>
        </div>
        <table id="tbl-gel">
            <thead><tr id="head-gel"><th>ì‹œê°„ \ g/h</th></tr></thead>
            <tbody id="body-gel"></tbody>
        </table>
    </div>
</div>

<script>
    const inT = document.getElementById('in-time'), inC = document.getElementById('in-carb');
    const inG = document.getElementById('in-per-gel'), inS = document.getElementById('in-sweat');
    
    const carbCols = [40, 50, 60, 70, 80, 90, 100, 110];
    const timeRows = [120, 240, 360, 480, 600, 720, 840, 960, 1020];
    const GEL_RATIO = 0.6; // ì „ì²´ íƒ„ìˆ˜í™”ë¬¼ì˜ 60%ë§Œ íŒŒì›Œì ¤ë¡œ ë³´ê¸‰í•œë‹¤ê³  ê°€ì •

    function fmtTime(m) { 
        const h = Math.floor(m/60);
        const min = m%60;
        return min > 0 ? `${h}ì‹œê°„ ${min}ë¶„` : `${h}ì‹œê°„`; 
    }

    function initTable() {
        const hGel = document.getElementById('head-gel');
        hGel.innerHTML = '<th>ì‹œê°„ \\ g/h</th>'; 
        carbCols.forEach(c => {
            const th = document.createElement('th');
            th.innerText = c + 'g';
            th.setAttribute('data-col-val', c);
            hGel.appendChild(th);
        });
        update(); 
    }

    function update() {
        const t = +inT.value, c = +inC.value, g = +inG.value, s = +inS.value;
        const hours = t / 60;

        document.getElementById('disp-time').textContent = fmtTime(t);
        document.getElementById('disp-carb').textContent = c;
        document.getElementById('disp-per-gel').textContent = g;
        document.getElementById('disp-sweat').textContent = s;

        // ê³„ì‚° ë¡œì§ (60% ì „ëµ ë°˜ì˜)
        const totalCarb = Math.round(hours * c);
        const gelCount = ((totalCarb * GEL_RATIO) / g).toFixed(1);
        
        document.getElementById('res-total-carb').textContent = totalCarb;
        document.getElementById('res-gel-count').textContent = gelCount;
        document.getElementById('res-total-water').textContent = (hours * s).toFixed(1);

        // 30ê°œ ì´ˆê³¼ ì‹œ ê²½ê³  í‘œì‹œ
        const warning = document.getElementById('gel-warning');
        if (gelCount >= 25) {
            warning.style.display = 'block';
            warning.innerText = gelCount >= 30 ? "âš ï¸ ìœ„ì¥ í•œê³„ ë„ë‹¬! ê³ í˜•ì‹ í•„ìˆ˜" : "âš ï¸ íŒŒì›Œì ¤ ê³¼ë‹¤ (ì£¼ì˜)";
        } else {
            warning.style.display = 'none';
        }

        const bGel = document.getElementById('body-gel');
        bGel.innerHTML = "";
        timeRows.forEach(tr => {
            const row = document.createElement('tr');
            row.setAttribute('data-time-val', tr);
            let rowHtml = `<td><b>${Math.floor(tr/60)}h</b></td>`;
            carbCols.forEach(cc => {
                const count = ((tr/60) * cc * GEL_RATIO / g).toFixed(1);
                rowHtml += `<td data-carb-val="${cc}">${count}</td>`;
            });
            row.innerHTML = rowHtml;
            bGel.appendChild(row);
        });

        document.querySelectorAll('.hl-cell, .hl-header').forEach(el => el.classList.remove('hl-cell', 'hl-header'));
        const targetTh = document.querySelector(`#head-gel th[data-col-val="${c}"]`);
        if(targetTh) targetTh.classList.add('hl-header');

        const rows = document.querySelectorAll('#body-gel tr');
        let closestRow = rows[0];
        let minDiff = Math.abs(t - timeRows[0]);
        rows.forEach(r => {
            const diff = Math.abs(t - r.getAttribute('data-time-val'));
            if(diff < minDiff) { minDiff = diff; closestRow = r; }
        });

        if(closestRow) {
            const targetTd = closestRow.querySelector(`td[data-carb-val="${c}"]`);
            if(targetTd) targetTd.classList.add('hl-cell');
        }
    }

    [inT, inC, inG, inS].forEach(el => el.addEventListener('input', update));
    initTable();

    function downloadCSV(tableId, filename) {
        const table = document.getElementById(tableId);
        if (!table) return;
        let csv = [];
        const rows = table.querySelectorAll("tr");
        for (let i = 0; i < rows.length; i++) {
            let row = [], cols = rows[i].querySelectorAll("td, th");
            for (let j = 0; j < cols.length; j++) {
                let data = cols[j].innerText.replace(/(\r\n|\n|\r)/gm, "").replace(/"/g, '""');
                row.push('"' + data + '"');
            }
            csv.push(row.join(","));
        }
        const csvFile = new Blob(["\uFEFF" + csv.join("\n")], {type: "text/csv;charset=utf-8;"});
        const link = document.createElement("a"); link.download = filename; link.href = window.URL.createObjectURL(csvFile);
        link.style.display = "none"; document.body.appendChild(link); link.click(); document.body.removeChild(link);
    }
</script>
</body>
</html>