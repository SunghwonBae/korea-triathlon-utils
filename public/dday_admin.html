<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì² ì¸3ì¢… ëŒ€íšŒ ê´€ë¦¬ì</title>
    <style>
        :root { --primary: #0070f3; --bg: #f4f7f6; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { font-size: 1.5rem; margin-bottom: 20px; color: var(--primary); }
        textarea { width: 100%; height: 300px; border: 1px solid #ddd; border-radius: 8px; padding: 15px; font-size: 14px; resize: vertical; margin-bottom: 15px; }
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:hover { background: #0056b3; }
        #log { margin-top: 20px; padding: 15px; border-radius: 8px; background: #eee; font-size: 13px; max-height: 200px; overflow-y: auto; }
        .success { color: #2ecc71; } .error { color: #e74c3c; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ† ëŒ€íšŒ ì¼ì • ì¼ê´„ ë“±ë¡</h1>
        <p>ì¹´í˜ì˜ ëŒ€íšŒ ëª©ë¡ í…ìŠ¤íŠ¸ë¥¼ ì•„ë˜ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</p>
        <textarea id="rawText" placeholder="2026. 3. 29&#10;ì¼&#10;ë‚˜ì£¼ ì˜ì‚°ê°•ë“€ì• ìŠ¬ë¡  ëŒ€íšŒ&#10;..."></textarea>
        <button onclick="processData()">íŒŒì‹± ë° ë°ì´í„° ì „ì†¡</button>
        <div id="log">ì¤€ë¹„ ì™„ë£Œ...</div>
    </div>

    <script>
        function addLog(msg, type = '') {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += `<div class="${type}">${msg}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        async function processData() {
            const text = document.getElementById('rawText').value;
            if(!text.trim()) return alert("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            
            const logDiv = document.getElementById('log');
            logDiv.innerHTML = "<b>ë¶„ì„ ì‹œì‘...</b><br>";
            
            const lines = text.split('\n').map(l => l.trim()).filter(l => l !== "");
            let count = 0;

            for (let i = 0; i < lines.length; i++) {
                // ë‚ ì§œ íŒ¨í„´ ë§¤ì¹­ (2026. 3. 29 ë“±)
                const dateMatch = lines[i].match(/^(\d{4}\.\s?\d{1,2}\.\s?\d{1,2})/);
                
                if (dateMatch) {
                    const startDate = dateMatch[1].replace(/\s/g, '').replace(/\./g, '-');
                    const title = lines[i+2]; // ìš”ì¼ ë‹¤ìŒ ì¤„ì´ ëŒ€íšŒëª…

                    if (title && !title.includes('ìš”ì¼') && title.length > 2) {
                        try {
                            const res = await fetch('/api/ddays', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    title: title,
                                    startDate: startDate,
                                    type: 'public'
                                })
                            });
                            if (res.ok) {
                                addLog(`âœ… ë“±ë¡ ì„±ê³µ: ${title}`, 'success');
                                count++;
                            }
                        } catch (err) {
                            addLog(`âŒ ì‹¤íŒ¨: ${title}`, 'error');
                        }
                    }
                }
            }
            addLog(`<b>ì´ ${count}ê°œì˜ ëŒ€íšŒê°€ ë“±ë¡/ì—…ë°ì´íŠ¸ ë˜ì—ˆìŠµë‹ˆë‹¤.</b>`);
        }
    </script>
</body>
</html>