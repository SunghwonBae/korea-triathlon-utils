<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—…í ë¶„ì„ê¸°</title>
    <link rel="icon" href="/favicon.ico" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="stylesheet" href="bucheonTriStyle.css">
    <script src="menu_full_handler.js" defer></script>
    <style>
        :root { --primary: #e67e22; --danger: #d63031; --success: #27ae60; --bg: #f8f9fa; }

        /* ë¹„ì£¼ì–¼ & ìƒíƒœì°½ */
        .visual-container { height: 160px; background: #e0f7fa; position: relative; border-radius: 15px; overflow: hidden; margin-bottom: 20px; display: flex; align-items: flex-end; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .road { width: 200%; height: 500px; background: #555; position: absolute; bottom: -450px; transform-origin: center; transition: 0.5s; border-top: 4px dashed #fff; }
        .bike { font-size: 45px; position: relative; z-index: 5; bottom: 10px; transition: 0.5s; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); }
        
        .status-board { background: #fff; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 25px; border: 1px solid #ffe0b2; box-shadow: 0 4px 15px rgba(230, 126, 34, 0.1); }
        .main-res { font-size: 2.5em; font-weight: 800; color: var(--primary); margin: 10px 0; letter-spacing: -1px; }
        #course-tag { font-size: 1.1em; margin-bottom: 5px; }

        /* ì…ë ¥ ê·¸ë¦¬ë“œ */
        .setup-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .group { display: flex; flex-direction: column; background: #fff; padding: 15px; border-radius: 12px; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.02); transition: transform 0.2s; }
        .group:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        
        label { font-size: 0.9em; font-weight: 700; margin-bottom: 10px; color: #555; display: flex; justify-content: space-between; align-items: center; }
        label span { color: var(--primary); font-size: 1.2em; font-weight: 800; }
        
        input[type="range"] { width: 100%; cursor: pointer; accent-color: var(--primary); height: 6px; border-radius: 3px; }
        input[type="number"], select, input[type="text"] { padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-top: 5px; font-size: 1rem; width: 100%; box-sizing: border-box; }
        input[type="number"]:focus, select:focus { outline: none; border-color: var(--primary); }

        /* ì§ì ‘ ì…ë ¥ ì„¹ì…˜ */
        .custom-row { display: flex; gap: 10px; margin-top: 10px; }
        .add-btn { background: #2d3436; color: white; border: none; padding: 0 20px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: background 0.2s; white-space: nowrap; }
        .add-btn:hover { background: #000; }

        /* ê²°ê³¼ í…Œì´ë¸” */
        .table-wrapper { overflow-x: auto; border-radius: 12px; border: 1px solid #eee; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
        table { width: 100%; border-collapse: collapse; font-size: 0.95em; background: #fff; min-width: 500px; }
        th { background: #f8f9fa; padding: 15px; border-bottom: 2px solid #dee2e6; color: #444; font-weight: 700; }
        td { padding: 12px 15px; text-align: center; border-bottom: 1px solid #f1f1f1; color: #333; }
        tr.active-row { background: #fff3e0 !important; border-left: 4px solid var(--primary); }
        tr.active-row td { font-weight: bold; color: #d35400; }
        tr.clickable { transition: background 0.1s; }
        tr.clickable:hover { background: #f8f9fa; cursor: pointer; }
        
        .rpm-bad { color: var(--danger); font-weight: bold; background: #fff5f5; border-radius: 4px; padding: 2px 6px; }
        .rpm-good { color: var(--success); font-weight: bold; background: #e8f5e9; border-radius: 4px; padding: 2px 6px; }
        .highlight-box { border: 2px solid var(--primary) !important; background: #fff9f5; }
        
        .hint { font-size: 0.85em; color: #888; margin-top: 8px; text-align: right; margin-bottom: 5px; }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            .setup-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
            .group { grid-column: 1 / -1; }
            .half-mobile { grid-column: auto; }
            .visual-container { height: 140px; }
            .bike { font-size: 35px; }
            .main-res { font-size: 2em; }
            .status-board { padding: 15px; }
            
            th, td { padding: 10px 8px; font-size: 0.85em; }
            .custom-row { flex-direction: row; }
            input[type="number"], select { font-size: 0.9rem; padding: 8px; }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header-section">
        <button id="menuToggle" class="menu-btn" aria-label="ë©”ë‰´ ì—´ê¸°">â˜°</button>
        <h1>ğŸ”ï¸ ì—…í ë¶„ì„ê¸°</h1>
    </div>

    <div class="visual-container">
        <div id="road" class="road"></div>
        <div id="bike" class="bike">ğŸš´</div>
    </div>

    <div class="status-board">
        <div id="course-tag" style="font-weight:bold; color:var(--primary);">ì½”ìŠ¤ ë¶„ì„ ì¤‘...</div>
        <div class="main-res"><span id="speed-display">0.0</span> km/h</div>
        <div id="current-gear-info" style="font-size: 0.9em; color: #666;">ê¸°ì¤€ ê¸°ì–´: 34-34T (1.00)</div>
    </div>

    <div class="setup-grid">
        <div class="group" style="grid-column: 1 / -1;">
            <label>ê²½ì‚¬ë„ ì„¤ì • <span id="val-slope">7</span>%</label>
            <input type="range" id="slope" min="0" max="25" step="0.5" value="7" oninput="run('slope')">
        </div>

        <div class="group highlight-box">
            <label>ëª©í‘œ íŒŒì›Œ (Watt) <span id="val-power">200</span>W</label>
            <input type="range" id="power" min="50" max="800" step="5" value="200" oninput="run('power')">
        </div>

        <div class="group highlight-box">
            <label>ëª©í‘œ ì¼€ì´ë˜ìŠ¤ (RPM) <span id="val-cadence">80</span>rpm</label>
            <input type="range" id="cadence" min="30" max="120" step="1" value="80" oninput="run('cadence')">
        </div>

        <div class="group half-mobile"><label>ìì „ê±° ë¬´ê²Œ (kg)</label><input type="number" id="bikeW" value="8.5" oninput="run()"></div>
        <div class="group half-mobile"><label>ë‚´ ëª¸ë¬´ê²Œ (kg)</label><input type="number" id="riderW" value="75" oninput="run()"></div>
        <div class="group half-mobile">
            <label>íœ  ê·œê²©</label>
            <select id="wheel" onchange="run()">
                <option value="2105">700c x 25mm</option>
                <option value="2136">700c x 28mm</option>
                <option value="2155">700c x 30mm</option>
                <option value="1938">650c x 23mm</option>
                <option value="2100">650b x 28mm</option>
            </select>
        </div>
        <div class="group half-mobile">
            <label>í˜„ì¬ ê¸°ì¤€ ê¸°ì–´ë¹„</label>
            <input type="text" id="baseGearDisplay" value="1.00 (34-34T)" disabled style="background:#eee; text-align:center; font-weight:bold;">
            <input type="hidden" id="baseGearVal" value="1.0">
        </div>
        <div class="group">
            <label>âœ¨ ë‚´ ì–¸ë• ê¸°ì–´ ì§ì ‘ ì¶”ê°€</label>
            <div class="custom-row">
                <input type="number" id="cF" placeholder="ì•(T)">
                <input type="number" id="cR" placeholder="ë’¤(T)">
                <button class="add-btn" onclick="addGear()">ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <h3>âš™ï¸ ê¸°ì–´ë¹„ ë¶„ì„ ë¦¬ìŠ¤íŠ¸ (í´ë¦­í•˜ì—¬ ê¸°ì¤€ìœ¼ë¡œ ì„¤ì •)</h3>
    <div class="hint">* í‘œì˜ í–‰ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ê¸°ì–´ë¹„ë¡œ ìŠ¬ë¼ì´ë”ê°€ ë™ê¸°í™”ë©ë‹ˆë‹¤.</div>
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>ê¸°ì–´ ì¢…ë¥˜</th>
                    <th>ì¡°í•© (F-R)</th>
                    <th>ê¸°ì–´ë¹„</th>
                    <th>í•„ìš” ì¼€ì´ë˜ìŠ¤</th>
                </tr>
            </thead>
            <tbody id="res-body"></tbody>
        </table>
    </div>
</div>

<script>
let GEAR_PRESETS = [
    { cat: "ì»´íŒ©íŠ¸", name: "ìƒì¡´", f: 34, r: 34 },
    { cat: "ì»´íŒ©íŠ¸", name: "í‘œì¤€", f: 34, r: 32 },
    { cat: "ì»´íŒ©íŠ¸", name: "ì¤‘ê¸‰", f: 34, r: 30 },
    { cat: "ì»´íŒ©íŠ¸", name: "ìƒê¸‰", f: 34, r: 28 },
    { cat: "ë¯¸ë“œì»´íŒ©", name: "ìƒì¡´", f: 36, r: 34 },
    { cat: "ë¯¸ë“œì»´íŒ©", name: "í‘œì¤€", f: 36, r: 30 },
    { cat: "ë¯¸ë“œì»´íŒ©", name: "ìƒê¸‰", f: 36, r: 28 },
    { cat: "ìŠ¤íƒ ë‹¤ë“œ", name: "ê¸°ë³¸", f: 39, r: 28 },
    { cat: "ì „ë¬¸ê°€", name: "TT", f: 56, r: 28 },
    { cat: "ì „ë¬¸ê°€", name: "ì´ˆê³ ì†", f: 60, r: 28 }
];

function addGear() {
    const f = parseInt(document.getElementById('cF').value);
    const r = parseInt(document.getElementById('cR').value);
    if(f && r) {
        GEAR_PRESETS.push({ cat: "ì§ì ‘ì…ë ¥", name: "ì»¤ìŠ¤í…€", f: f, r: r });
        document.getElementById('cF').value = ""; document.getElementById('cR').value = "";
        run();
    }
}

// í´ë¦­ ì‹œ ê¸°ì¤€ ê¸°ì–´ë¹„ë¥¼ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
function setAsBase(ratio, label) {
    document.getElementById('baseGearVal').value = ratio;
    document.getElementById('baseGearDisplay').value = `${ratio.toFixed(2)} (${label})`;
    document.getElementById('current-gear-info').innerText = `ê¸°ì¤€ ê¸°ì–´: ${label} (${ratio.toFixed(2)})`;
    run('cadence'); // ì¼€ì´ë˜ìŠ¤ ê³ ì • ìƒíƒœì—ì„œ íŒŒì›Œ ì—­ì‚°
}

function run(mode) {
    const slope = parseFloat(document.getElementById('slope').value);
    const bikeW = parseFloat(document.getElementById('bikeW').value);
    const riderW = parseFloat(document.getElementById('riderW').value);
    const wheel = parseInt(document.getElementById('wheel').value);
    const baseRatio = parseFloat(document.getElementById('baseGearVal').value);
    const totalW = bikeW + riderW;
    const g = 9.81;
    const Crr = 0.005;
    const rad = Math.atan(slope/100);

    let power = parseFloat(document.getElementById('power').value);
    let cadence = parseFloat(document.getElementById('cadence').value);

    if (mode === 'cadence') {
        const v_kmh = (baseRatio * wheel * cadence * 60) / 1000000;
        const v_ms = v_kmh / 3.6;
        power = totalW * g * v_ms * (Math.sin(rad) + Crr);
        document.getElementById('power').value = Math.min(800, Math.round(power));
    } else {
        let v_ms = power / (totalW * g * (Math.sin(rad) + Crr));
        let kmh = Math.max(0, v_ms * 3.6);
        cadence = (kmh * 1000000) / (baseRatio * wheel * 60);
        document.getElementById('cadence').value = Math.min(120, Math.round(cadence));
    }

    // UI ì—…ë°ì´íŠ¸
    document.getElementById('val-slope').innerText = slope;
    document.getElementById('val-power').innerText = document.getElementById('power').value;
    document.getElementById('val-cadence').innerText = document.getElementById('cadence').value;
    
    const deg = rad * (180/Math.PI);
    document.getElementById('road').style.transform = `rotate(-${deg}deg)`;
    document.getElementById('bike').style.transform = `rotate(-${deg}deg)`;

    const currentPower = parseFloat(document.getElementById('power').value);
    let final_v_ms = currentPower / (totalW * g * (Math.sin(rad) + Crr));
    let final_kmh = Math.max(0, final_v_ms * 3.6);
    document.getElementById('speed-display').innerText = final_kmh.toFixed(1);

    // ì½”ìŠ¤ íƒœê·¸
    const courseTag = document.getElementById('course-tag');
    let cName = "í‰ì§€";
    if (slope >= 11) cName = "í™”ì•…ì‚°ê¸‰ (ê³ í†µ)";
    else if (slope >= 7) cName = "ë¶ì•…/ëŒ€ê´€ë ¹ê¸‰ (ì¤‘ê¸‰)";
    else if (slope >= 4) cName = "ë‚¨ì‚°ê¸‰ (í‘œì¤€)";
    courseTag.innerText = "ìœ ì‚¬ ì½”ìŠ¤: " + cName;

    // í…Œì´ë¸” ë Œë”ë§
    const tbody = document.getElementById('res-body');
    tbody.innerHTML = "";
    GEAR_PRESETS.forEach(g => {
        const ratio = g.f / g.r;
        const rpm = (final_kmh * 1000000) / (ratio * wheel * 60);
        const rpmClass = rpm < 60 ? 'rpm-bad' : (rpm >= 70 && rpm <= 95 ? 'rpm-good' : '');
        const isActive = ratio.toFixed(2) === baseRatio.toFixed(2) ? "active-row" : "";
        
        tbody.innerHTML += `
            <tr class="clickable ${isActive}" onclick="setAsBase(${ratio}, '${g.f}-${g.r}T')">
                <td>${g.cat}</td>
                <td>${g.f}-${g.r}T (${g.name})</td>
                <td>${ratio.toFixed(2)}</td>
                <td class="${rpmClass}">${Math.round(rpm)} RPM</td>
            </tr>`;
    });
}
run();
</script>
</body>
</html>